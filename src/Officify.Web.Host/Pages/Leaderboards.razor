@page "/leaderboards"

@using Officify.Models
@using Officify.Models.Competitions
@using Officify.Web.Host.Leaderboard
@inject OfficifyApiClient Api;

<LoadingIndicator IsLoading="@IsLoading"/>

@if (CurrentCompetitionId.HasValue && !IsLoading)
{
    <LeaderboardTable CompetitionId="@CurrentCompetitionId.Value" />    
}

@code
{
    private bool IsLoading { get; set; }
    private ListResult<CompetitionModel> Competitions { get; set; } = ListResult<CompetitionModel>.EmptyListResult();
    private Guid? CurrentCompetitionId { get; set; }

    protected override async Task OnInitializedAsync()
    {
        IsLoading = true;
        StateHasChanged();

        Competitions = await Api.GetCompetitionsAsync();
        CurrentCompetitionId = Competitions.Items.Length > 0
            ? Competitions.Items[0].Id
            : null;
        IsLoading = false;
        StateHasChanged();
    }
}